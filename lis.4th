( aux ) warnings off                                            : cc page clearstacks ; : ]l ] postpone literal ;               : v: variable ; : 2v: 2variable ; : vl: value ;                 : c: constant ; : 2c: 2constant ; : 3drop 2drop drop ;          : 3drop 2drop drop ; : not 0= ;                                 : 1= 1 = ; : 2= 2 = ; : 2+ 2 + ; : 2- 2 - ; : 10= 10 = ;        : i+ i + ; : i- i - ; : ++ rot + -rot + swap ;                  : even 2 mod 0= ; : odd 2 mod 0<> ; : s>num s>number drop ;     : sort 2dup max -rot min ; : -sort 2dup min -rot max ;          : +- dup even if 1+ else 1- then ;                              : winw form nip ; : winh form drop ;                            : 00xy 0 0 at-xy ; : 01xy 0 1 at-xy ; : 21xy 2 1 at-xy ;        : bl? bl = ; : esc? dup 27 = ; : cr? dup 13 = ;                 : bksp? dup 127 = ; : digit? '0 '9 1+ within ;                                                                                  : -if postpone not postpone if ; immediate                      ( auxiliary definitions                                                                                                                                are used across the code.                                                                                                       some may be useful to other programs.                                                                    )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( colors ) 2v: colr                                             30 c: black  31 c: red      32 c: green   33 c: yellow          34 c: blue   35 c: magenta  36 c: cyan    37 c: white           : digs 10 /mod '0 + swap '0 + swap emit emit ;                  : colo esc[ digs 'm emit ; : bg 10 + ;                          : colo> colr @ colo ; : swp colr 2@ swap colr 2! ;              : !remem colr @ swap colr 2! ;                                                                                                  : yellow! yellow colr ! ; : green! green colr ! ;               : white! white colr ! ; : red! red colr ! ;                     : blu blue colo ; : blubg blue bg colo ;                        : bnw black bg colo white colo ;                                                                                                                                                                                                                                                                                                ( files )                                                       v: file                                                         : fname" bl word count ;                                        : fmake r/w create-file ;                                       : fopen r/w open-file ;                                         : fmake drop fmake throw file ! ;                               : fopen 2dup fopen 0= if file ! 2drop exit then fmake ;         : fwrite file @ write-file throw ; ( appends )                  : fclose file @ close-file throw ;                              : "write fopen fwrite fclose ;                                  : write" ( buf len "file ) fname" "write ;                                                                                                                                                                                                                                                                                                                                                      ( boxes )                                                       : horiz 9473 xemit ; : topl 9487 xemit ; : topr 9491 xemit ;    : botr  9499 xemit ; : botl 9495 xemit ; : vert 9475 xemit ;                                                                    64 vl: w  16 vl: h  2v: offs                                    : len w h * ;                                                   : ofs offs 2@ ; : iff offs 2@ 1 1 ++ offs 2! ;                  : hor w 0 do horiz loop ;                                       : top ofs at-xy topl hor topr ;                                 : bot ofs h 1+ + at-xy botl hor botr ;                          : ver 1+ 2dup at-xy vert w 0 at-deltaxy vert ;                  : ver ofs h 0 do ver loop 2drop ;                               : box top ver bot ;                                                                                                             : bar 00xy blubg winw spaces 00xy .s bnw ;                                                                                      ( boxes                                                                                                                                width and heigth -- w , h -- are hardcoded.                                                                                     position also depends on the xy offset -- offs .                                                                         )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( blocks )                                                      128 c: #blks  len #blks * c: size  2v: #blk  v: buf             create blocks here size bl fill size allot                      : blk #blk ! blocks #blk @ len * + buf ! ;                      : blk% #blks mod blk ;                                          : blk+ #blk @ 2+ blk% ; : blk- #blk @ 2- blk% ;                 : shadw #blk @ +- ; : shadw! shadw blk ; : shadw? #blk @ odd ;  : bfgo #blk @ swap dup blk #blk 2! ;                            : alt #blk 2@ swap dup blk #blk 2! ;                            : #alt alt #blk 2@ drop ;                                                                                                       s" [ ! -e blocks.4th ] && touch blocks.4th" system              : fname s" blocks.4th" ; : file? fname slurp-file ;             : fread file? blocks swap move ;                                : fsave blocks size fname "write ; fread  0 blk                                                                                 (                                                                blocks                                                         2v: #blk v: buf                                                 : buf! block buf ! ;                                            : bufmem #blk @ swap #blk 2! ;                                  : blk dup bufmem buf! ;                                         : blk+ #blk @ 2+ blk ;                                          : blk- #blk @ 2- blk ;                                          : alt #blk 2@ swap dup buf! #blk 2! ;                           : shadw #blk @ +- ;                                             : shadw! shadw buf ! ;                                          : shadw? #blk @ odd ;                                            : .--> shadw run shadw ;                                                                                                                                                                        )                                                              ( buffers )                                                     : buf: create len allot ; buf: mov buf: ynk                     create fnd w allot                                              : >mov buf @ mov len move ;                                     : mov> mov buf @ len move ;                                     : bfswp >mov buf @ swap blk buf @ swap len move mov> ;          : bfswp #blk @ >r bfswp r> blk ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( special buffers                                                                                                                                are present to move or copy a block.                                                                                            mov for swaping blocks.                                                                                                         ynk for copying blocks or lines.                                                                               )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( cursor )                                                      v: ind                                                          : lim 0 max len 1- min ; : ind! lim ind ! ;                     : pos ind @ w /mod ; : cur pos ofs ++ ; : refr cur at-xy ;      : x+ ind @ 1+ ind! ; : x- ind @ 1- ind! ; : cx pos drop ;       : y+ ind @ w + ind! ; : y- ind @ w - ind! ; : cy pos nip ;      : x0 ind @ cx - ; : x$ ind @ w cx - 1- + ;                                                                                      : whe buf @ ind @ ; : where@ whe + ; : what where@ c@ ;         : bef whe 1- + c@ ; : aft whe 1+ + c@ ; : 2bef whe 2- + c@ ;    : beg? cx 0= ; : end? cx w 1- = ;                               : bob ind @ 0= ; : eob ind @ len 1- = ; : beob bob eob or ;     : buf@ buf @ len ;                                                                                                              : bef? bef bl? ; : aft? aft bl? ;                               : -bef? bef bl <> ; : -aft? aft bl <> ;                         ( cursor position                                                                                                                                results from splitting the buffer index -- ind                                                                                  according to line width [ ind w /mod ].                                                                                         cursor screen position -- cur -- also uses offs                                                                                 with ind, much data can be extracted:                                                                                           - are we at the start or end of buffer? -- beob                                                                                 - what is the current character at ind ?                                                                                        - is the current character a blank? etc.       )                                                               ( syntax ) : @bl? what bl? ; : -bl? what bl <> ; 2v: @syn       : !rem @syn @ swap @syn 2! ; : rem @syn 1 cells + @ @syn ! ;    : wrd? beg? bef? or aft? and ; : what? what = wrd? and ;        : int @syn @ 0= if yellow! rdrop then ;                         : )com @bl? bef ') = and 2bef bl? and ;                         : )com )com if swp rem rdrop then ;                             : com @syn @ 1= if white !remem )com rdrop then ;               : def @syn @ 2= if red! rdrop then ;                            : cmp @syn @ 4 = if green! rdrop then ;                         : com? '( what? if 1 !rem rdrop then ;                          : def? ': what? if 2 @syn ! rdrop then ;                        : ent? @syn @ 2 = -bl? and if 3 @syn ! rdrop then ;             : cmp? @syn @ 3 = @bl? and if 4 @syn ! rdrop then ;             : int? '; what? if @syn off rdrop then ;                        : syn? int? com? def? ent? cmp? int? ;                          : syn syn? int com def cmp ; : syn syn colo> ;                  ( syntax highlighting                                                                                                                                uses @syn to know at which state we are.                                                                                        in some cases, the current color and state                      are remembered before being altered.                                                                                            syn? and syn go through various checks.                                                                                         syn also chages the current color.                                                                         )                                                                                                                                                                                                                                                                                                                               ( content )                                                     : run buf@ evaluate ; : run@ whe evaluate ;                     : ld #blk @ >r 2* blk run r> blk ;                              : tru -sort 1+ swap do i ld loop ;                              : nl y+ x0 ind! ; : nl? cr? over 10= or if nl drop rdrop then ; : put nl? syn emit x+ ; : wrt where@ c! ;                       : putbl ind @ x$ ind! bl wrt ind! refr ;                        : prnt len 0 do refr buf @ i + @ put loop ;                     : prnt ind off prnt ind off @syn off refr ;                     : bufcl buf @ len bl fill ; : prsrv ind @ prnt ind! refr ;      : pull where@ whe 1- + w cx - cmove putbl prsrv ;               : push where@ whe 1+ + w cx - 1- cmove> prsrv ;                 : ibksp? bksp? if pull x- drop rdrop then ;                     : rbksp? bksp? if x- refr bl wrt bl emit refr drop rdrop then ;                                                                                                                                 ( content of the block                                                                                                                                it can be loaded -- ld , tru --                                                                                                 it can be evaluated up to the cursor                            or entirely -- run@ , run                                                                                                       nl? convert newlines into spaces                                                                                                put prints chars and wrt saves them to buf                                                                                      pull and push move chars for insertion or                       deletion                                                                                                                        ibksp? and rbksp? are for the insert or                         replace mode backspace.                  )( count )                                                       v: cmd v: cnt v: #cnt                                           : cntbf s"     " ;                                              : keep cmd ! ;                                                  : 0keep ['] noop keep ;                                         : 0cnt 0keep cnt off #cnt off s"    " drop cntbf move ;         : cnt+ #cnt @ 1+ dup #cnt ! 4 > if 0cnt then ;                  : >cnt cntbf drop #cnt @ + c! ;                                 : >cnt >cnt cntbf s>num cnt ! cnt+ ;                            : dig? cnt @ if '0 else '1 then '9 1+ within ;                  : cnt? dup dig? if >cnt rdrop then ;                            : cnt. cnt @ 0 <# # # # # #> type ;                             : reps cnt @ 1 max 0 do cmd @ execute loop 0cnt ;                                                                                                                                                                                                               ( counts                                                                                                                                can be provided to repeat commands.                                                                                             some commands where the count is used for something else        need to contain 0cnt to clear the repetition counter.                                                                           the counter is stored as a string of length 4.                                                                                  the execution token of the command to be repeated is            kept in the variable cmd .                              )                                                                                                                                                                                                                                                                                                                               ( commands ) v: lastk v: 'draw : draw 'draw @ execute ;         : prep page bar 01xy ; : .quit1 page bar 00xy quit ;            : .quit2 0 ofs nip h + 1+ at-xy white colo quit ;               : -bl @bl? -aft? and eob or ; : till what = beob or ;           : .clr$ where@ w cx - bl fill ind @ prnt ind! ;                 : .clr key 'C = if bufcl prnt then ;                            : .run prep run .quit1 ; : .run@ prep run@ .quit2 ;             : .blk+ blk+ draw ; : .blk- blk- draw ; : .alt alt draw ;       : .beg x0 ind! ; : .end x$ ind! ; : .top cx ind! ;              : .bot len w - cx + ind! ; : .del ind @ pull draw ind! ;        : .nex begin x+ @bl? -aft? and eob or until ;                   : .prv begin x- @bl? -bef? and bob or until ;                   : til+ begin lastk @ x+ till until ; : .til+ key lastk ! til+ ; : til- begin lastk @ x- till until ; : .til- key lastk ! til- ; : ln- .beg where@ whe w + + len ind @ - w - cmove> ;            : .ln- ln- where@ w bl fill prsrv ; : .ln+ y+ .ln- ;            : .shadw shadw! draw ; : .shswp shadw bfswp draw ;              : .bfswp cnt @ 2* bfswp 0cnt draw ; : .alt alt draw ;           : .>mov >mov draw ; : .mov> mov> draw ;                         : .bfgo cnt @ 2* bfgo 0cnt draw ;                               : cpln .beg where@ ynk w move ; : .cpln ind @ cpln draw ind! ;  : ptln .beg ynk where@ w move ; : .ptln ind @ ptln draw ind! ;  : delln .beg where@ w + where@ len ind @ w + - move ;           : delln delln .bot where@ w bl fill ;                           : .delln key 'D = if ind @ delln prnt ind! then ;               : .loc1 21xy ." / " fnd 1+ w 1- accept fnd c! fnd c@ ;          : .loc2 where@ over fnd count str= ;                            : .loc+ fnd c@ begin x+ .loc2 beob or until refr drop ;         : .loc- fnd c@ begin x- .loc2 beob or until refr drop ;         : .loccl 21xy w 1- spaces ; : .loc/ .loccl .loc1 .loc+ drop ;                                                                                                                                   ( normal )                                                      : 2next dup 2over rot cells + 2@ dup 0<> ;                      : nokey 0keep 3drop 3drop rdrop ; : --- , ' , ;                 : dokey rot = if keep 3drop rdrop else drop 2+ then ;           create .normal 'i --- noop   'r --- noop   'B --- .bfgo          'j --- y+     'G --- .bot   'w --- .nex   'c --- .clr$          'k --- y-     'g --- .top   'b --- .prv   'C --- .clr           'l --- x+     '0 --- .beg   'x --- .run@  'd --- .del           ', --- x-     '$ --- .end   'X --- .run   'D --- .delln         'f --- .til+  'J --- .blk+  'o --- .ln+   'a --- .shadw         'F --- .til-  'K --- .blk-  'O --- .ln-   'A --- .alt           '; --- til+   't --- .shswp 'y --- .cpln  'p --- .ptln          ': --- til-   'T --- .bfswp 'Y --- .>mov  'P --- .mov>          '/ --- .loc/  'n --- .loc+  'N --- .loc-  'S --- fsave          'Q --- .quit2                                                  0 , 0 , does> 0 begin 2next if dokey else nokey then again ;    ( normal mode commands                                                                                                                                are usually prefixed by a dot -- just'cos.                                                                                      the .normal array loop through until a                          a char matching the one passed is found                         or the zero at the end.                   )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( modes )                                                       v: mode                                                         : mode> mode @ execute ;                                        : keys key mode> ;                                              : nrml cnt? .normal reps ;                                      : >nrml ['] nrml mode ! ;                                       : nrml? esc? if drop >nrml .loccl rdrop then ;                  : ins nrml? ibksp? push dup wrt put ;                           : rep nrml? rbksp? dup wrt put ;                                : >ins ['] ins mode ! ;                                         : >rep ['] rep mode ! ;                                         ' >ins ' .normal >body 1 cells + !                              ' >rep ' .normal >body 3 cells + !                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( config )                                                      : eq space 8656 xemit 8658 xemit space ;                        : bxcol shadw? if yellow else green then colo ;                 : shdw. shadw? if blu ofs 1- at-xy ." SHADOW" then ;            : left 2 2 offs 2! ; : dims 64 to w 16 to h ;                   : prt# 0 <# # # #> type ;                                       : cur. blu ofs w 6 - -1 ++ at-xy cx prt# bl emit cy prt# ;      : cnt. blu ofs w 5 - h ++ at-xy cnt. bnw ;                      : alt. eq #blk 2@ drop 2/ 0 <# # #s #> type ;                   : blk. ." BLK " #blk @ 2/ 0 <# # #s #> type alt. ;              : blk. blu ofs h + at-xy blk. bnw ;                             >nrml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( tui )                                                         : empty s" ---marker--- marker ---marker---" evaluate ;         : draw page bar left bxcol box iff blk. cnt. shdw. prnt ;       ' draw 'draw !                                                                                                                  : lis draw begin keys blk. cur. cnt. bar refr again ;           : l lis ;                                                       marker ---marker---                                             lis                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             : >> postpone >r ' compile, postpone r> ; immediate             : dr postpone dup postpone >> postpone -rot ; immediate         : 3or or or or ;                                                : dot 9608 xemit ;                                              : dot 183 xemit ;                                               : xy postpone 2r@ ; immediate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   v: flgs : f! flgs @ or flgs ! ; : f@ flgs @ ; : f0 flgs off ;   14 ld : h winh ; : w winw ; : dim w h * 1- ;                    : xy/ w /mod winh 1+ mod 2dup ; : xy\ winh - abs at-xy ;        : zz dim xy/ at-xy ;                                            : 0/ dup 0 <> if / else drop then ;                                                                                             : eq0 swap dup * 128 / = f! ;                                   : eq1 dup * 32 / = f! ;                                         : eq2 swap over 2* 0/ = f! ;                                    : eq3 38 * 10 / - 0= f! ; : eq4 2dup rot * -rot * + 10 = f! ;   : eq5 dup 3 * dup * * 2000 / 256 - = f! ;                       : eq 2>r xy eq3 xy eq1 xy eq0 xy eq5 2rdrop f@ f0 ;                                                                             : pt xy/ eq if xy\ dot else 2drop then ;                        : fg page zz dim for i pt next 2drop ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (( boxes )                                                       80 vl: w  winh 2- vl: h  2v: offs  2 2 offs 2!                  : len w h * ;                                                   : ofs offs 2@ ; : iff offs 2@ 1 1 ++ offs 2! ;                  : hor ( w ) 0 do horiz loop ;                                   : top >r ofs at-xy topl r> hor topr ;                           : bot 2>r ofs ( h ) r> 1+ + at-xy botl ( w ) r> hor botr ;      : ver 1+ 2dup at-xy vert 2>r dup 0 at-deltaxy vert 2r> ;        : ver ofs rot 0 do ver loop 3drop ;                             : box ( w h ) to h to w w top w h ver w h bot ;                 : obox ( offs w h ) 2swap offs 2! box ;                         : edbox winw 4 / 2 w h obox ;                                                                                                                                                                                                                                                                                                   ( resizable boxes                                                                just change the VALUES of w and h.                                                                                              edbox: 80 wide, winh 2- high box               )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( cursor )                                                      v: ind                                                          : lim 0 max len 1- min ; : ind! lim ind ! ;                     : pos ind @ w /mod ; : cur pos ofs ++ ; : refr cur at-xy ;      : x+ ind @ 1+ ind! ; : x- ind @ 1- ind! ; : cx pos drop ;       : y+ ind @ w + ind! ; : y- ind @ w - ind! ; : cy pos nip ;      : x0 ind @ cx - ; : x$ ind @ w cx - 1- + ;                                                                                      : whe buf @ ind @ ; : where@ whe + ; : what where@ c@ ;         : bef whe 1- + c@ ; : aft whe 1+ + c@ ; : 2bef whe 2- + c@ ;    : beg? cx 0= ; : end? cx w 1- = ;                               : bob ind @ 0= ; : eob ind @ len 1- = ; : beob bob eob or ;     : buf@ buf @ len ;                                                                                                              : bef? bef bl? ; : aft? aft bl? ;                               : -bef? bef bl <> ; : -aft? aft bl <> ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( content )                                                     : nl y+ x0 ind! ; : nl? cr? over 10= or if nl drop rdrop then ; : put nl? syn emit x+ ; : wrt where@ c! ;                       : putbl ind @ x$ ind! bl wrt ind! refr ;                        : prnt len 0 do refr buf @ i + @ put loop ;                     : prnt ind off prnt ind off @syn off refr ;                     : bufcl buf @ len bl fill ; : prsrv ind @ prnt ind! refr ;      : pull where@ whe 1- + w cx - cmove putbl prsrv ;               : push where@ whe 1+ + w cx - 1- cmove> prsrv ;                 : ibksp? bksp? if pull x- drop rdrop then ;                     : rbksp? bksp? if x- refr bl wrt bl emit refr drop rdrop then ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( count )                                                       v: cmd v: cnt v: #cnt                                           : cntbf s"     " ;                                              : keep cmd ! ;                                                  : 0keep ['] noop keep ;                                         : 0cnt 0keep cnt off #cnt off s"    " drop cntbf move ;         : cnt+ #cnt @ 1+ dup #cnt ! 4 > if 0cnt then ;                  : >cnt cntbf drop #cnt @ + c! ;                                 : >cnt >cnt cntbf s>num cnt ! cnt+ ;                            : dig? cnt @ if '0 else '1 then '9 1+ within ;                  : cnt? dup dig? if >cnt rdrop then ;                            : cnt. cnt @ 0 <# # # # # #> type ;                             : reps cnt @ 1 max 0 do cmd @ execute loop 0cnt ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( html )                                                        : .html create ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( html )                                                        : 2next dup 2over rot cells + 2@ dup 0<> ;                      : nokey 0keep 3drop 3drop rdrop ; : --- , ' , ;                 : dokey rot = if keep 3drop rdrop else drop 2+ then ;           create .normal 'i --- noop   'r --- noop   'B --- .bfgo          'j --- y+     'G --- .bot   'w --- .nex   'c --- .clr$          'k --- y-     'g --- .top   'b --- .prv   'C --- .clr           'l --- x+     '0 --- .beg   'x --- .run@  'd --- .del           ', --- x-     '$ --- .end   'X --- .run   'D --- .delln         'f --- .til+  'J --- .blk+  'o --- .ln+   'a --- .shadw         'F --- .til-  'K --- .blk-  'O --- .ln-   'A --- .alt           '; --- til+   't --- .shswp 'y --- .cpln  'p --- .ptln          ': --- til-   'T --- .bfswp 'Y --- .>mov  'P --- .mov>          'Q --- .quit  'S --- fsave   0 , 0 ,                           does> 0 begin 2next if dokey else nokey then again ;            : nrml cnt? .normal reps ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      : a 'a emit ;                                                   : b rdrop 'b emit ;                                             : c 'c emit ;                                                   : oi a r> . r> . b c ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          : rnip 2r> swap drop >r ;                                       : rswap 2r> swap 2>r ;                                          : w1 ." a" rswap ." b" ;                                        : w2 ." c" ." d" ;                                              : w3 ." e" ." f" ;                                              : oi w1 w2 w3 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( bubble )                                                      : vec s" apcee01zx" ; v: cnt : cnt+ 1 cnt +! ;                  : .. cr cnt @ 0 <# # # # # # #> type space vec type cnt+ space ; : sli s" sleep .2" system ; : .. cnt @ 20 < if sli .. then ;   : 4drop 2drop 2drop ;                                           : or- or not ; : ini over + 2- over 0 ; ( vec -- amaf )         : cmp dup 1+ over c@ over c@ swap 2dup < dup ; ( ama--aACcff )  : swp if rot c! over c! else 3drop then ; ( ama )               : adv 2dup = if drop over 0 else 1+ -1 then dup ( ambff ) ;     : bub ini begin .. >r cmp r> or >r swp adv r@ or- swap                0= if rdrop 0 >r then r> swap until ;                     : bub vec bub ;                                                                                                                                                                                                                                                                                                                 (                                                                problem:                                                                                                                        at the end of each loop, i must check if:                       - there was a swap                                              - there was an advancement in position                          if any of these conditions is true, i must repeat the loop.     [ie. 0 0 or not until => end loop ]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )                                                               ( bubble )                                                      : vec s" abbracadabra's house of fun (1 of them)" ;                                                                             : cmp dup 1+ over c@ swap c@ 2dup > ; ( a -- accf )             : swp if rot >r r@ c! r@ 1+ c! r> 0 else 2drop -1 then ; ( af ) : adv1 drop swap ; : adv2 swap -1 rot ; : -adv 1+ rot 0 ;       : adv >r -rot 2dup = if adv1 r> adv2 else rdrop -adv then and ; : ini over + 1- swap ;                                          : bub ini >r r@ begin cmp swp r@ adv until ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( bubble )                                                      : vec s" abbracadabra's house of fun (1 of them)" ;                                                                             : cmp dup 1+ over c@ swap c@ 2dup > ; ( a -- accf )             : swp if rot >r r@ c! r@ 1+ c! 0 r> else 2drop -1 swap then ;                                                                   : adv 1+ 2over + > if >r over                                                                                                   : bubs over >r begin r@ cmp swp r@ ;                                                                                                                                                                                                                                                                                            : cmp r@ c@ r@ 1+ c@ 2dup > ;                                   : swp if r@ c! r@ 1+ c! 0 else 2drop -1 then ;                                                                                  ( bubble )                                                      : vec s" abbracadabra's house of fun (1 of them)" ;                                                                             v: v$ v: 'v                                                     : ini over + v$ ! dup 'v ! ; ( vec -- a )                       : lim dup v$ @ > if drop 'v @ -1 else 0 then ;                  : cmp dup 1+ over c@ swap c@ 2dup > ;  ( a -- accf )            : swp  rot >r r@ tuck c! 1+ c! r> 1+ ;                          : swp? if swp -1 else 2drop 1+ 0 then ; ( accf -- a+1 f )       : .. cr vec type ;                                              : .. cr .s ;                                                    : bubs ini begin lim >r cmp swp? r> and until ;                                                                                                                                                                                                                                                                                 https://codereview.stackexchange.com/questions/244775/bubble-sort-in-forth-for-strings                                                                                                         https://codereview.stackexchange.com/questions/244775/bubble-sort-in-forth-for-strings                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( tasks ) 20 ld 7 c: dvs v: y v: m v: d : divx winw dvs / ;     : 2# 0 <# # # #> type ; : 4# 0 <# # # # # #> type ; : c colo ;  : r red c ; : g green c ; : b blue c ; : yr b 4# ; : mon g 2# ; : day r 2# ; : date time&date yr mon day bnw 3drop ;            : date winw 8 - winh at-xy date ;                               : divs. winh 1- for 2dup at-xy vert 1+ next 2drop ;             : divs. dvs 1 do divx i * 0 divs. loop ;                        : lab s"  hom pli mar prs mkt jus tec" ; : bls 9 spaces ;       : labs r dvs for bls lab + 3 i * - i 1- - 3 type bls next bnw ; : .draw page labs divs. date 00xy quit ;                        : get s" ./tasks" slurp-file ;                                                                                                                                                                                                                                                                                                                                                                  : str+ dup >r 2swap pad place pad count + swap move r> pad +! ; : str+. str+ pad count type ;                                                                                                   : entry '$ scan ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : xtskp >r begin dup while over c@ r@ execute while 1 /string           repeat then r> drop ;                                   : xt dup 'a = swap 'b = or ;                                                                                                                                                                     acx   ac  acc  ac  aca  acC  acx    bd   bd1                       x                            -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              